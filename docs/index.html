<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Parfum d'Or - Luxo em Perfumes</title>
  <link rel="stylesheet" href="styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display&family=Montserrat&display=swap"
    rel="stylesheet" />
</head>

<body>
  <header>
    <div class="header-texts">
      <h1>Parfum d'Or</h1>
      <p>Decantes de Luxo em cada Gota</p>
    </div>

    <nav hidden>
      <button id="hamburger-btn" aria-label="Abrir menu" aria-expanded="false" aria-controls="menu-list" >
        <!-- Ícone hamburger simples SVG -->
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#d4c06d" stroke-width="3"
          stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="6" x2="21" y2="6" />
          <line x1="3" y1="12" x2="21" y2="12" />
          <line x1="3" y1="18" x2="21" y2="18" />
        </svg>
      </button>
      <ul id="menu-list" class="menu-list" hidden>
        <li><a href="index.html">Início</a></li>
        <li><a href="cosmeticos.html">Cosméticos</a></li>
        <li><a href="produtos2.html">Produtos 2</a></li>
        <li><a href="pedido.html">Pedido</a></li>
        <!-- outros links aqui -->
      </ul>
    </nav>

    <div id="cart-icon" title="Ver carrinho" aria-label="Abrir carrinho" tabindex="0" role="button">
      <!-- Ícone do carrinho SVG -->
      <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path
          d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2S15.9 22 17 22s2-.9 2-2-.9-2-2-2zM7.16 14l1.25-2.5h7.98c.62 0 1.1-.48 1.1-1.1 0-.04-.02-.07-.02-.11L16.11 7H6l-.14-.29-1-2.01H1v2h2l3.6 7.59-1.35 2.44C4.17 17.05 4 17.48 4 18c0 1.1.9 2 2 2h12v-2H7.42c-.07-.19-.17-.37-.26-.57z">
        </path>
      </svg>
      <div id="cart-count" style="display:none">0</div>
    </div>
  </header>

  <main class="container" id="perfumes-container">
    <!-- Cards serão inseridos aqui via JS -->
  </main>

  <script>
    // Elementos DOM
    const container = document.getElementById('perfumes-container');
    const cartIcon = document.getElementById('cart-icon');
    const cartCountEl = document.getElementById('cart-count');
    const hamburgerBtn = document.getElementById('hamburger-btn');
    const menuList = document.getElementById('menu-list');

    // Carrinho interno: array de { perfume, volume, quantity }
    let cart = [];

    // Função para criar um card de perfume
    function createCard(perfume) {
      const card = document.createElement('div');
      card.classList.add('card');

      // Cria um id/slug para identificar o produto
      const productId = perfume.id || perfume.name.replace(/\s+/g, '-').toLowerCase();
      card.setAttribute('data-product-id', productId);

      card.innerHTML = `
    <img src="${perfume.image}" alt="${perfume.name}">
    <div class="card-content">
      <h2>${perfume.name}</h2>
      <div class="volume-buttons">
        <button class="btn-volume" data-volume="2ml">2ml</button>
        <button class="btn-volume" data-volume="5ml">5ml</button>
        <button class="btn-volume" data-volume="10ml">10ml</button>
      </div>
      <div class="price-display">
        <p>Preço: R$ <span class="price-value">${perfume.value.value5ml}</span></p>
      </div>
      <button class="btn-add">Adicionar</button>
    </div>
  `;

      const btns = card.querySelectorAll('.btn-volume');
      const priceValue = card.querySelector('.price-value');
      const addBtn = card.querySelector('.btn-add');

      // Define volume padrão como 5ml
      let selectedVolume = '5ml';

      // Marca como ativo o botão do volume padrão (5ml)
      btns.forEach(btn => {
        if (btn.getAttribute('data-volume') === selectedVolume) {
          btn.classList.add('active');
        }
      });

      // Atualiza preço quando mudar volume
      btns.forEach(btn => {
        btn.addEventListener('click', (event) => {
          event.stopPropagation(); // evita que clique no botão dispare o clique no card
          btns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');

          selectedVolume = btn.getAttribute('data-volume');

          if (selectedVolume === '2ml') priceValue.textContent = perfume.value.value2ml;
          else if (selectedVolume === '5ml') priceValue.textContent = perfume.value.value5ml;
          else if (selectedVolume === '10ml') priceValue.textContent = perfume.value.value10ml;
        });
      });

      // Botão adicionar ao carrinho
      addBtn.addEventListener('click', (event) => {
        event.stopPropagation(); // evita que clique dispare o clique no card
        addToCart(perfume, selectedVolume);
      });

      // Clique no card redireciona para a página de detalhes (exceto nos botões)
      card.addEventListener('click', () => {
        window.location.href = `detalhes/index.html?product=${encodeURIComponent(productId)}`;
      });

      return card;
    }



    // Adiciona item no carrinho (incrementa se já existe)
    function addToCart(perfume, volume) {
      const itemIndex = cart.findIndex(
        item => item.perfume.name === perfume.name && item.volume === volume
      );

      if (itemIndex > -1) {
        cart[itemIndex].quantity++;
      } else {
        cart.push({ perfume, volume, quantity: 1 });
      }
      updateCartCount();
      // Opcional: salva no localStorage já
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    // Atualiza contador do ícone do carrinho
    function updateCartCount() {
      const totalItems = cart.reduce((acc, item) => acc + item.quantity, 0);
      if (totalItems > 0) {
        cartCountEl.style.display = 'flex';
        cartCountEl.textContent = totalItems;
      } else {
        cartCountEl.style.display = 'none';
      }
    }

    // Carrega perfumes do data.json e cria cards
    function loadPerfumes() {
      fetch('data.json')
        .then(response => {
          if (!response.ok) {
            throw new Error(`Erro ao carregar data.json: ${response.statusText}`);
          }
          return response.json();
        })
        .then(data => {
          data.perfumes.forEach(dataObject => {
            const card = createCard(dataObject);
            container.appendChild(card);
          });
        })
        .catch(error => {
          container.innerHTML = `<p style="color: #f00; text-align: center;">${error.message}</p>`;
        });
    }

    // Toggle menu hambúrguer
    hamburgerBtn.addEventListener('click', () => {
      const expanded = hamburgerBtn.getAttribute('aria-expanded') === 'true';
      hamburgerBtn.setAttribute('aria-expanded', String(!expanded));
      if (menuList.hasAttribute('hidden')) {
        menuList.removeAttribute('hidden');
      } else {
        menuList.setAttribute('hidden', '');
      }
    });

    // Fecha menu ao clicar fora
    document.addEventListener('click', (e) => {
      if (!hamburgerBtn.contains(e.target) && !menuList.contains(e.target)) {
        menuList.setAttribute('hidden', '');
        hamburgerBtn.setAttribute('aria-expanded', 'false');
      }
    });

    // Navega para página pedido ao clicar no ícone do carrinho
    cartIcon.addEventListener('click', () => {
      localStorage.setItem('cart', JSON.stringify(cart));
      window.location.href = 'pedido.html';
    });

    // Carregar carrinho salvo no localStorage se existir, para manter estado após reload
    function loadCartFromStorage() {
      const savedCart = localStorage.getItem('cart');
      if (savedCart) {
        try {
          cart = JSON.parse(savedCart);
        } catch {
          cart = [];
        }
      }
    }

    // Inicialização
    loadCartFromStorage();
    loadPerfumes();
    updateCartCount();
  </script>

</body>

</html>